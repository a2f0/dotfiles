#!/bin/bash

# unset all aliases
unalias -a

# re-source aliases
[ -e ~/.aliases ] && source ~/.aliases
[ -e ~/.aliases-private ] && source ~/.aliases-private
[ -e ~/.functions ] && source ~/.functions
[ -e ~/.quick ] && source ~/.quick

# unset all functions
for function in `declare -F | awk '{ print $3 }' `; do unset -f  "$function"; done

[ -e ~/.functions ] && source ~/.functions
[ -e ~/.functions-posix ] && source ~/.functions-posix
[ -e ~/.functions-private ] && source ~/.functions-private

# enable vi mode (set +o vi to revert)
set -o vi

# set the editor
export EDITOR="vim"

# set the umask to prevent files from being created with access
# to group members or others
umask 0077

# custom compiled software (./configure --prefix=~/install)
export PATH=$PATH:~/install/bin

# from ~/.functions
bash_prompt
loadrbenv

# also see efnet/freenode functions in ~/.functions
export IRCSERVER="irc.servercentral.net 9999 IRC-SSL"
export IRCNICK="dps"
export IRCNAME="dps"

# enable timestamp on bash_history
export HISTTIMEFORMAT="%d.%m.%y %T "
# exempt commands that start with spaces from ~/.bash_history
export HISTCONTROL=ignorespace

# pyenv, installed via brew
export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# use UTF-8 - Ansible requires this.
export LC_ALL=en_US.UTF-8

if [ `uname` == Darwin ]; then
    # suppress deprecation warning
    export BASH_SILENCE_DEPRECATION_WARNING=1

    # don't use GitHub's personal access token for features such as brew search
    export HOMEBREW_NO_GITHUB_API=1

    # use UTF-8.
    export LC_ALL=en_US.UTF-8

    # android studio
    export ANDROID_SDK=$HOME/Library/Android/Sdk
    export ANDROID_SDK_ROOT=$HOME/Library/Android/Sdk
    export PATH=$PATH:$HOME/Library/Android/Sdk/tools/bin
    export PATH=$PATH:$HOME/Library/Android/Sdk/emulator
    export PATH=$PATH:$HOME/Library/Android/Sdk/platform-tools
    export PATH=$PATH:$HOME/Library/Android/Sdk/build-tools/30.0.3

    # go, installed via brew
    export GOPATH=$HOME/go
    export PATH="$PATH:${GOPATH}/bin"

    # az cli, installed via brew
    source /usr/local/etc/bash_completion.d/az

    # jenv, installed via brew
    export PATH="$HOME/.jenv/bin:$PATH"
    eval "$(jenv init -)"

    # fastlane
    export PATH="$HOME/.fastlane/bin:$PATH"

    # gcloud
    if [ -f "$HOME/google-cloud-sdk/path.bash.inc" ]; then . "$HOME/google-cloud-sdk/path.bash.inc"; fi
    if [ -f "$HOME/google-cloud-sdk/completion.bash.inc" ]; then . "$HOME/google-cloud-sdk/path.bash.inc"; fi

    # nvm, installed via brew
    export NVM_DIR="$HOME/.nvm"
    [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
    [ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"  # This loads nvm bash_completion

    # for git gpg signature verification
    export GPG_TTY=$(tty)

elif [ `uname -n` == archlinux ]; then
    # init volume to 20.
    #amixer sset Master 67%
    PATH=$PATH:/opt/local/scripts
    PATH=$PATH:~/.cabal/bin
    PATH=$PATH:/usr/local/heroku/bin
    # vendor perl, for perlbrew
    PATH=$PATH:/usr/bin/vendor_perl
    # disable terminal beep
    # setterm -blength 0
    # X Desktop Group Configuration Paths
    export XDG_CONFIG_HOME=$HOME/.config
    export XDG_CACHE_HOME=$HOME/.cache

    # android studio
    export ANDROID_SDK=$HOME/Android/Sdk
    export ANDROID_SDK_ROOT=$HOME/Android/Sdk
    export PATH=$PATH:$HOME/Android/Sdk/tools/bin
    export PATH=$PATH:$HOME/Android/Sdk/emulator
    export PATH=$PATH:$HOME/Android/Sdk/platform-tools
    export PATH=$PATH:$HOME/Android/Sdk/build-tools/33.0.0

    # jre and jdk installed via pacman (jdk-openjdk and jre-openjdk)
    export JAVA_HOME=/usr/lib/jvm/default
    # To run android studio in xmonad.
    export _JAVA_AWT_WM_NONREPARENTING=1

    # nvm, installed via curl
    export NVM_DIR="$HOME/.config/nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
fi
