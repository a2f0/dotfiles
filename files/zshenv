# zshenv - sourced for ALL zsh invocations (interactive, non-interactive, login, non-login)
# Keep this minimal and fast - no output, no interactive features

# Guard against double-sourcing within the same shell instance
# Use a non-exported variable so child shells still get initialized
if [[ -n "$__ZSHENV_SOURCED" ]]; then
  return
fi
__ZSHENV_SOURCED=1

# Homebrew - must come first to set up PATH for other tools
# Support both Apple Silicon (/opt/homebrew) and Intel (/usr/local) Macs
if [[ "$(uname)" == Darwin ]]; then
  if [[ -x /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [[ -x /usr/local/bin/brew ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
  fi
fi

# pyenv - installed via brew or git
export PYENV_ROOT="$HOME/.pyenv"
if [[ -d "$PYENV_ROOT/bin" ]]; then
  export PATH="$PYENV_ROOT/bin${PATH:+:${PATH}}"
fi
if command -v pyenv >/dev/null 2>&1; then
  eval "$(pyenv init -)"
fi

# rbenv - installed via brew or git
if [[ -d "$HOME/.rbenv/bin" ]]; then
  export PATH="$HOME/.rbenv/bin${PATH:+:${PATH}}"
fi
if command -v rbenv >/dev/null 2>&1; then
  eval "$(rbenv init - zsh)"
fi

# nvm - set up NVM_DIR and load nvm for version file support
# Support both Apple Silicon (/opt/homebrew) and Intel (/usr/local) Macs
export NVM_DIR="$HOME/.nvm"
if [[ -s "/opt/homebrew/opt/nvm/nvm.sh" ]]; then
  \. "/opt/homebrew/opt/nvm/nvm.sh"
elif [[ -s "/usr/local/opt/nvm/nvm.sh" ]]; then
  \. "/usr/local/opt/nvm/nvm.sh"
elif [[ -s "$NVM_DIR/nvm.sh" ]]; then
  \. "$NVM_DIR/nvm.sh"
fi

# jenv - installed via brew or git
if [[ -d "$HOME/.jenv/bin" ]]; then
  export PATH="$HOME/.jenv/bin${PATH:+:${PATH}}"
fi
if command -v jenv >/dev/null 2>&1; then
  eval "$(jenv init -)"
fi

# rust/cargo - installed via rustup
if [[ -f "$HOME/.cargo/env" ]]; then
  . "$HOME/.cargo/env"
fi

# Essential PATH additions
export PATH="$HOME/.local/bin${PATH:+:${PATH}}"
